FROM node:22-alpine

WORKDIR /home/node/app
COPY package*.json ./
RUN npm install

ARG DOMAIN
ARG OPENAI_API_KEY
ARG ASTRA_DB_APPLICATION_TOKEN
ARG ASTRA_DB_ENDPOINT
ARG ASTRA_DB_NAMESPACE

ENV NEXT_PUBLIC_DOMAIN=${DOMAIN}
ENV NEXT_PUBLIC_OPENAI_API_KEY=${OPENAI_API_KEY}
ENV NEXT_PUBLIC_ASTRA_DB_APPLICATION_TOKEN=${ASTRA_DB_APPLICATION_TOKEN}
ENV NEXT_PUBLIC_ASTRA_DB_ENDPOINT=${ASTRA_DB_ENDPOINT}
ENV NEXT_PUBLIC_ASTRA_DB_NAMESPACE=${ASTRA_DB_NAMESPACE}
ENV NODE_ENV=production
COPY . .
RUN npm run build

EXPOSE 3000

# Command to start the application
CMD ["npm", "start"]

